
@{
    ViewBag.Title = "网站设置";
    Layout = "~/Views/Shared/_Layout.cshtml";
    object webSet = ViewBag.WebSet;
    var levelTypeInfo = typeof(St.Domain.Entity.LevelInfo);
}

<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">@ViewBag.Title</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-cogs fa-fw"></i> 设置中心
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="list-group">
                        @{
                            var properties = webSet.GetType().GetProperties();
                            foreach (var item in properties)
                            {
                                var itemAttributes = item.CustomAttributes;
                                string displayName = string.Empty;//中文描述名称
                                if (itemAttributes.Where(p => p.AttributeType == typeof(System.ComponentModel.DisplayNameAttribute)).Count() > 0)
                                {
                                    var displayAttribute = itemAttributes.Single(p => p.AttributeType == typeof(System.ComponentModel.DisplayNameAttribute));
                                    displayName = displayAttribute.ConstructorArguments[0].Value.ToString();
                                }
                                var itemValue = item.GetValue(webSet);


                                <div class="form-group">
                                    <label class="col-sm-3">@displayName</label>
                                    @{
                                        foreach (var lv in levelTypeInfo.GetEnumValues())
                                        {
                                            <label class="radio-inline">
                                                <input type="radio" name="@item.Name" value="0" @{if ( itemValue.ToString() == lv.ToString()) { @Html.Raw("checked"); } }>@lv.ToString()
                                            </label>
                                        }
                                    }
                                </div>
    }
                        }

                        <div class="form-group">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    说明：
                                </div>
                                <div class="panel-body">
                                    <p>
                                        设定每个区域最低级别进入权限。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.list-group -->
                    <a href="javascript:void(0)" onclick="goSaveWebSet()" class="btn btn-default btn-block">保  存</a>
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->

        </div>
    </div>
</div>
<script>
    function goSaveWebSet() {
        var productLevel = getRadioValue("ProductsLevel");
        var newsLevel = getRadioValue("NewsLevel");
        var adsLevel = getRadioValue("AdsLevel");
        var imageLevel = getRadioValue("ImagesLevel");
        var settingLevel = getRadioValue("SettingLevel");

        $.ajax({
            url: "/SUser/SaveWebSet",
            type: "post",
            data: { productLevel: productLevel, newsLevel: newsLevel, adsLevel: adsLevel, imageLevel: imageLevel, settingLevel: settingLevel }
        }).done(function (data) {
            alert(data.returnMessage);
            location.reload();
        })
    }

    function getRadioValue(name) {
        var result = "";
        var obj = document.getElementsByName(name);
        for (var i = 0; i < obj.length; i++) {
            if (obj[i].checked) {
                result = obj[i].value;
                break;
            }
        }
        return result;
    }
</script>

